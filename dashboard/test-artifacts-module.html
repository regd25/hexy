<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Artifacts Module Test</title>
        <style>
            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
                    sans-serif;
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
                background: #0f172a;
                color: #e2e8f0;
            }
            .container {
                background: #1e293b;
                border-radius: 8px;
                padding: 24px;
                margin-bottom: 20px;
            }
            .button {
                background: #3b82f6;
                color: white;
                border: none;
                padding: 12px 24px;
                border-radius: 6px;
                cursor: pointer;
                margin: 8px;
                font-size: 14px;
                transition: background 0.2s;
            }
            .button:hover {
                background: #2563eb;
            }
            .button:disabled {
                background: #64748b;
                cursor: not-allowed;
            }
            .output {
                background: #0f172a;
                border: 1px solid #334155;
                border-radius: 6px;
                padding: 16px;
                margin-top: 16px;
                font-family: 'Monaco', 'Menlo', monospace;
                font-size: 13px;
                white-space: pre-wrap;
                max-height: 400px;
                overflow-y: auto;
            }
            .success {
                color: #10b981;
            }
            .error {
                color: #ef4444;
            }
            .warning {
                color: #f59e0b;
            }
            .info {
                color: #3b82f6;
            }
            h1 {
                color: #f1f5f9;
                margin-bottom: 8px;
            }
            h2 {
                color: #cbd5e1;
                margin-bottom: 16px;
            }
            .status {
                display: inline-block;
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 12px;
                font-weight: 600;
                margin-left: 8px;
            }
            .status.ready {
                background: #10b981;
                color: white;
            }
            .status.testing {
                background: #f59e0b;
                color: white;
            }
            .status.error {
                background: #ef4444;
                color: white;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>üöÄ Artifacts Module Test Suite</h1>
            <h2>Enhanced Hexy Framework Artifacts Management</h2>

            <div>
                <strong>Module Status:</strong>
                <span id="moduleStatus" class="status ready">READY</span>
            </div>

            <div style="margin-top: 20px">
                <h3>üß™ Test Flows</h3>
                <button class="button" onclick="runTest('demo')">
                    Quick Demo
                </button>
                <button class="button" onclick="runTest('basicCRUD')">
                    Basic CRUD
                </button>
                <button class="button" onclick="runTest('validation')">
                    Semantic Validation
                </button>
                <button class="button" onclick="runTest('eventBus')">
                    Event Bus
                </button>
                <button class="button" onclick="runTest('temporal')">
                    Temporal Artifacts
                </button>
                <button class="button" onclick="runTest('search')">
                    Search & Filter
                </button>
                <button class="button" onclick="runTest('backup')">
                    Data Backup
                </button>
                <button
                    class="button"
                    onclick="runTest('runAll')"
                    style="background: #059669"
                >
                    Run All Tests
                </button>
            </div>

            <div style="margin-top: 20px">
                <h3>üìñ Examples</h3>
                <button class="button" onclick="runExample('createSimple')">
                    Create Simple
                </button>
                <button class="button" onclick="runExample('validate')">
                    Validate
                </button>
                <button class="button" onclick="runExample('search')">
                    Search
                </button>
                <button class="button" onclick="runExample('temporal')">
                    Temporal
                </button>
                <button class="button" onclick="runExample('statistics')">
                    Statistics
                </button>
                <button
                    class="button"
                    onclick="runExample('runAll')"
                    style="background: #7c3aed"
                >
                    Run All Examples
                </button>
            </div>

            <div style="margin-top: 20px">
                <h3>üîß Utilities</h3>
                <button class="button" onclick="clearOutput()">
                    Clear Output
                </button>
                <button class="button" onclick="clearStorage()">
                    Clear Storage
                </button>
                <button class="button" onclick="showModuleInfo()">
                    Module Info
                </button>
            </div>

            <div id="output" class="output">
                Welcome to the Artifacts Module Test Suite! üéâ This module
                provides: ‚úÖ Complete CRUD operations for artifacts ‚úÖ Semantic
                validation following Hexy Framework principles ‚úÖ D3.js
                visualization properties ‚úÖ Event bus integration ‚úÖ Temporal
                artifact management ‚úÖ Advanced search and filtering ‚úÖ Data
                integrity and backup features Click any button above to start
                testing! üìù Note: All tests run in your browser using
                localStorage for persistence.
            </div>
        </div>

        <script type="module">
            let testRunner, examples
            let isLoading = false

            // Initialize the module
            async function initModule() {
                try {
                    // Import TypeScript files directly (Vite will handle compilation)
                    const testModule = await import(
                        './src/modules/artifacts-module/test-flows.ts'
                    )
                    const exampleModule = await import(
                        './src/modules/artifacts-module/example-usage.ts'
                    )
                    testRunner = testModule
                    examples = exampleModule

                    appendOutput('üéØ Module loaded successfully!', 'success')
                    updateStatus('ready')
                } catch (error) {
                    appendOutput(
                        `‚ùå Failed to load module: ${error.message}`,
                        'error'
                    )
                    updateStatus('error')
                    console.error('Module load error:', error)
                    
                    appendOutput(
                        `üí° Make sure you're running this through Vite dev server:`,
                        'info'
                    )
                    appendOutput(
                        `   npm run dev`,
                        'info'
                    )
                    appendOutput(
                        `   Then access: http://localhost:3000/test-artifacts-module.html`,
                        'info'
                    )
                }
            }

            // Run test function
            window.runTest = async function (testName) {
                if (isLoading) return
                if (!testRunner) {
                    appendOutput(
                        '‚ùå Module not loaded yet. Please wait...',
                        'error'
                    )
                    return
                }

                isLoading = true
                updateStatus('testing')
                disableButtons(true)

                try {
                    appendOutput(`\nüß™ Running test: ${testName}...`, 'info')

                    // Capture console output
                    const originalLog = console.log
                    const originalError = console.error
                    const originalWarn = console.warn

                    console.log = (...args) => {
                        appendOutput(args.join(' '), 'success')
                        originalLog(...args)
                    }

                    console.error = (...args) => {
                        appendOutput(args.join(' '), 'error')
                        originalError(...args)
                    }

                    console.warn = (...args) => {
                        appendOutput(args.join(' '), 'warning')
                        originalWarn(...args)
                    }

                    // Map test names to actual function names
                    const testMap = {
                        demo: 'runAllTests',
                        basicCRUD: 'testBasicCRUD',
                        validation: 'testValidationSystem',
                        eventBus: 'testEventBusIntegration',
                        temporal: 'testTemporalArtifacts',
                        search: 'testSearchAndFiltering',
                        backup: 'testDataIntegrityAndBackup',
                        runAll: 'runAllTests',
                    }

                    const actualTestName = testMap[testName] || testName

                    if (typeof testRunner[actualTestName] === 'function') {
                        await testRunner[actualTestName]()
                    } else {
                        throw new Error(
                            `Test function '${actualTestName}' not found`
                        )
                    }

                    // Restore console
                    console.log = originalLog
                    console.error = originalError
                    console.warn = originalWarn

                    appendOutput(
                        `‚úÖ Test '${testName}' completed successfully!\n`,
                        'success'
                    )
                } catch (error) {
                    appendOutput(
                        `‚ùå Test '${testName}' failed: ${error.message}`,
                        'error'
                    )
                    console.error('Test error:', error)
                } finally {
                    isLoading = false
                    updateStatus('ready')
                    disableButtons(false)
                }
            }

            // Run example function
            window.runExample = async function (exampleName) {
                if (isLoading) return
                if (!examples) {
                    appendOutput(
                        '‚ùå Examples not loaded yet. Please wait...',
                        'error'
                    )
                    return
                }

                isLoading = true
                updateStatus('testing')
                disableButtons(true)

                try {
                    appendOutput(
                        `\nüìñ Running example: ${exampleName}...`,
                        'info'
                    )

                    // Capture console output
                    const originalLog = console.log
                    const originalError = console.error

                    console.log = (...args) => {
                        appendOutput(args.join(' '), 'success')
                        originalLog(...args)
                    }

                    console.error = (...args) => {
                        appendOutput(args.join(' '), 'error')
                        originalError(...args)
                    }

                    // Map example names to actual function names
                    const exampleMap = {
                        'createSimple': 'createSimple',
                        'validate': 'validate',
                        'search': 'search',
                        'temporal': 'temporal',
                        'statistics': 'statistics',
                        'runAll': 'runAll'
                    };
                    
                    const actualExampleName = exampleMap[exampleName] || exampleName;
                    
                    if (typeof examples[actualExampleName] === 'function') {
                        await examples[actualExampleName]();
                    } else {
                        throw new Error(`Example function '${actualExampleName}' not found`);
                    }

                    // Restore console
                    console.log = originalLog
                    console.error = originalError

                    appendOutput(
                        `‚úÖ Example '${exampleName}' completed successfully!\n`,
                        'success'
                    )
                } catch (error) {
                    appendOutput(
                        `‚ùå Example '${exampleName}' failed: ${error.message}`,
                        'error'
                    )
                    console.error('Example error:', error)
                } finally {
                    isLoading = false
                    updateStatus('ready')
                    disableButtons(false)
                }
            }

            // Utility functions
            window.clearOutput = function () {
                document.getElementById('output').textContent =
                    'Output cleared.\n'
            }

            window.clearStorage = function () {
                localStorage.removeItem('hexy_artifacts')
                appendOutput('üßπ LocalStorage cleared!', 'info')
            }

            window.showModuleInfo = async function () {
                try {
                    const moduleInfo = await import('./src/modules/artifacts-module/index.ts')
                    
                    appendOutput('üì¶ Module Information:', 'info')
                    appendOutput(
                        `Name: ${moduleInfo.artifactsModule.name}`,
                        'info'
                    )
                    appendOutput(
                        `Version: ${moduleInfo.artifactsModule.version}`,
                        'info'
                    )
                    appendOutput(
                        `Description: ${moduleInfo.artifactsModule.description}`,
                        'info'
                    )
                    appendOutput('Features:', 'info')
                    moduleInfo.artifactsModule.features.forEach(feature => {
                        appendOutput(`  - ${feature}`, 'info')
                    })
                    if (moduleInfo.artifactsModule.testFlows) {
                        appendOutput('Available Test Flows:', 'info')
                        moduleInfo.artifactsModule.testFlows.forEach(flow => {
                            appendOutput(`  - ${flow}`, 'info')
                        })
                    }
                } catch (error) {
                    appendOutput(
                        `‚ùå Failed to load module info: ${error.message}`,
                        'error'
                    )
                }
            }

            // Helper functions
            function appendOutput(text, type = 'info') {
                const output = document.getElementById('output')
                const span = document.createElement('span')
                span.className = type
                span.textContent = text + '\n'
                output.appendChild(span)
                output.scrollTop = output.scrollHeight
            }

            function updateStatus(status) {
                const statusEl = document.getElementById('moduleStatus')
                statusEl.className = `status ${status}`
                statusEl.textContent = status.toUpperCase()
            }

            function disableButtons(disabled) {
                const buttons = document.querySelectorAll('.button')
                buttons.forEach(button => {
                    button.disabled = disabled
                })
            }

            // Initialize on load
            initModule()
        </script>
    </body>
</html>
